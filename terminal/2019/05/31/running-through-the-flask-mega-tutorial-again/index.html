<!doctype html><html lang=en><title>Running through The Flask Mega-Tutorial Again - Terminal In A Simputer Archives</title><meta charset=utf-8><link rel=canonical href=https://archives.snorl.ax/terminal/2019/05/31/running-through-the-flask-mega-tutorial-again/><link href=https://archives.snorl.ax/theme/css/all.css rel=stylesheet><link rel=dns-prefetch href=https://fonts.googleapis.com><link rel=dns-prefetch href=https://fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Luckiest+Guy|Rajdhani:600|Rajdhani:700&amp;display=swap"><link href=https://archives.snorl.ax/theme/images/icon.png rel=icon><link href=https://archives.snorl.ax/theme/images/icon-apple.png rel=apple-touch-icon-precomposed><link href=https://archives.snorl.ax/feeds/terminal.xml rel=alternate title="Simputer Archives Terminal RSS Feed" type=application/rss+xml><meta content=python name=tags><meta content=flask name=tags><meta content=learning notes name=tags><meta content="width=device-width" name=viewport><meta name=twitter:card content=summary><meta name=twitter:image content=https://archives.snorl.ax/theme/images/usual-twitter.png><meta name=twitter:site content=@Snorl_ax><meta name=twitter:title content="Running through The Flask Mega-Tutorial Again"><meta name=twitter:description content="Seems a doable tutorial project for me."><div id=a><header id=c><div id=d><h1 id=e><a href=https://archives.snorl.ax/>Simputer Archives</a></h1></div></header><div id=f><nav id=h><ul><li><a href=https://archives.snorl.ax/>Home</a><li><a href=https://archives.snorl.ax/browser/>Browser</a><li id=i><a href=https://archives.snorl.ax/terminal/>Terminal</a><li><a href=https://archives.snorl.ax/tags/>Tags</a></ul></nav><nav id=r><a href=https://www.youtube.com/channel/UCnqOLMtPJaqa7e_6FhZ8-rw title=Youtube><svg id="youtube"/></a><a href=https://github.com/SnorlaxYum/ title=Github><svg id="github"/></a><a href=https://twitter.com/Snorl_ax title=Twitter><svg id="twitter"/></a><a href=https://archives.snorl.ax/feeds/terminal.xml title="Terminal RSS"><svg id="rss"/></a><a href=mailto:sim@snorl.ax title=Email><svg id="mail"/></a></nav><aside id=j><form action=https://archives.snorl.ax/search.html onsubmit="return validateForm(this.elements['q'].value);"><input placeholder=Search... name=q id=tipue_search_input></form></aside></div></div><div id=b><main id=k><article id=m><header id=o><h2 id=p>Running through The Flask Mega-Tutorial Again</h2></header><div id=n><div id=series><p>This post is part 1 of the "The Flask Mega Tutorial" series:<ol class=parts><li id=i><a>Running through The Flask Mega-Tutorial Again</a><li><a href=https://archives.snorl.ax/terminal/2019/06/19/the-flask-mega-tutorial-rereading-part-2/>The Flask Mega-Tutorial Rereading - Part 2</a><li><a href=https://archives.snorl.ax/terminal/2019/08/27/the-flask-mega-tutorial-rereading-part-3-one-to-many-model/>The Flask Mega-Tutorial Rereading - Part 3 - One-To-Many Model</a></ol></div><h2 id=toc>Table Of Contents</h2><div class=toc><ul><li><a href=#chapter-1-hello-world>Chapter 1: Hello, World!</a><li><a href=#chapter-2-templates>Chapter 2: Templates</a><li><a href=#chapter-3-web-forms>Chapter 3: Web Forms</a><li><a href=#chapter-4-database>Chapter 4: Database</a><li><a href=#chapter-5-user-logins>Chapter 5: User Logins</a><ul><li><a href=#password-hashing>Password Hashing</a><li><a href=#introduction-to-flask-login>Introduction to Flask-Login</a><li><a href=#preparing-the-user-model-for-flask-login>Preparing The User Model for Flask-Login</a><li><a href=#user-loader-function>User Loader FUnction</a><li><a href=#logging-users-in>Logging Users In</a><li><a href=#logging-users-out>Logging Users Out</a><li><a href=#requiring-users-to-login>Requiring Users To Login</a><li><a href=#showing-the-logged-in-user-in-templates>Showing The Logged In User in Templates</a><li><a href=#user-registration>User Registration</a></ul><li><a href=#chapter-6-profile-pages>Chapter 6: Profile Pages</a><ul><li><a href=#avatars>Avatars</a><li><a href=#using-jinja2-sub-templates>Using Jinja2 Sub-Templates</a><li><a href=#more-interesting-profiles>More Interesting Profiles</a><li><a href=#recording-the-last-visit-time-for-a-user>Recording The Last Visit Time For a User</a><li><a href=#profile-editor>Profile Editor</a></ul></ul></div><p>This tutorial<sup id=fnref:1><a class=footnote-ref href=#fn:1 rel=footnote>1</a></sup> is really amazing and worth my second learning.<h2 id=chapter-1-hello-world><a class=toclink href=#chapter-1-hello-world>Chapter 1: Hello, World!</a></h2><p>This chapter talks about setting up virtualenv for the flask app and the structure is looking like this:<div class=highlight><pre><span class=code-line><span></span>microblog/</span>
<span class=code-line>  venv/</span>
<span class=code-line>  app/</span>
<span class=code-line>    __init__.py</span>
<span class=code-line>    routes.py</span>
<span class=code-line>  microblog.py</span>
</pre></div><p>Then I need to set environment variable:<div class=highlight><pre><span class=code-line><span></span>$ <span class=nv>FLASK_APP</span><span class=o>=</span>microblog.py</span>
</pre></div><p>Then run in the working dir:<div class=highlight><pre><span class=code-line><span></span>$ flask run</span>
</pre></div><p>That's quite organized but I found it's not mandatory.<p>All I need is this:<div class=highlight><pre><span class=code-line><span></span>microblog/</span>
<span class=code-line>  venv/</span>
<span class=code-line>  microblog.py</span>
</pre></div><p>Then put things I need together in <code>microblog.py</code> along with extra lines to run the app<sup id=fnref:2><a class=footnote-ref href=#fn:2 rel=footnote>2</a></sup>:<div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span></span>
<span class=code-line></span>
<span class=code-line><span class=n>app</span> <span class=o>=</span> <span class=n>Flask</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span></span>
<span class=code-line></span>
<span class=code-line><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)</span></span>
<span class=code-line><span class=nd>@app.route</span><span class=p>(</span><span class=s1>&#39;/index&#39;</span><span class=p>)</span></span>
<span class=code-line><span class=k>def</span> <span class=nf>index</span><span class=p>():</span></span>
<span class=code-line>    <span class=k>return</span> <span class=s2>&quot;Hello world!&quot;</span></span>
<span class=code-line></span>
<span class=code-line><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&quot;__main__&quot;</span><span class=p>:</span></span>
<span class=code-line>    <span class=n>app</span><span class=o>.</span><span class=n>run</span><span class=p>()</span></span>
</pre></div><p>Then I could execute it through atom or terminal with a simple command:<div class=highlight><pre><span class=code-line><span></span>$ python /home/sim/python-projects/microblog/app.py</span>
</pre></div><p>Or set environment var and do that way.<p>However, that structure in the tutorial is more modular and makes everything clearer so I followed the structure.<p>To remember the env var automatically each time <code>flask</code> is executed:<div class=highlight><pre><span class=code-line><span></span>$ pip install python-dotenv</span>
</pre></div><p>Then inside <code>.flaskenv</code>:<div class=highlight><pre><span class=code-line><span></span>FLASK_APP=microblog.py</span>
</pre></div><p>Involved module:<div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>Flask</span></span>
</pre></div><h2 id=chapter-2-templates><a class=toclink href=#chapter-2-templates>Chapter 2: Templates</a></h2><p>It's things about jinja2. I've been tangoing with it<sup id=fnref:3><a class=footnote-ref href=#fn:3 rel=footnote>3</a></sup> these days. So okay to me as well.<br>Involved module:<div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>render_template</span></span>
</pre></div><h2 id=chapter-3-web-forms><a class=toclink href=#chapter-3-web-forms>Chapter 3: Web Forms</a></h2><ul><li><code>app.config['SECRET_KEY']</code> from <code>os.environ.get</code>.<li>A login form with 'POST' and 'GET' method allowed.<br>Package: <code>flask-wtf</code><br>Involved modules:</ul><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask_wtf</span> <span class=kn>import</span> <span class=n>FlaskForm</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>wtforms</span> <span class=kn>import</span> <span class=n>StringField</span><span class=p>,</span> <span class=n>PasswordField</span><span class=p>,</span> <span class=n>BooleanField</span><span class=p>,</span> <span class=n>SubmitField</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>wtforms.validators</span> <span class=kn>import</span> <span class=n>DataRequired</span></span>
</pre></div><ul><li>Data response.
Involved modules:</ul><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>flash</span><span class=p>,</span> <span class=n>redirect</span></span>
</pre></div><p>The flashed messages can be obtained through <code>get_flashed_messages</code>.
* <code>url_for</code> is also introduced.<div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>url_for</span></span>
</pre></div><h2 id=chapter-4-database><a class=toclink href=#chapter-4-database>Chapter 4: Database</a></h2><p>Package:<ul><li><code>flask-sqlalchemy</code> (Flask-friendly wrapper to the popular SQLAlchemy package)<li><code>flask-migrate</code> (This extension is a Flask wrapper for Alembic, a database migration framework for SQLAlchemy.)</ul><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask_sqlalchemy</span> <span class=kn>import</span> <span class=n>SQLAlchemy</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>flask_migrate</span> <span class=kn>import</span> <span class=n>Migrate</span></span>
</pre></div><p>Then Configure <code>SQLALCHEMY_DATABASE_URI</code> and <code>SQLALCHEMY_TRACK_MODIFICATIONS</code>.<ul><li>Create models<li>Creating The Migration Repository<li>The First Database Migration<li>Database Upgrade and Downgrade Workflow<li>Database Relationships</ul><p>Additionally sometimes when developing in sqlite I need to drop a column I need to edit the recent migration script in <code>migrations</code> by changing the upgrade function<sup id=fnref:4><a class=footnote-ref href=#fn:4 rel=footnote>4</a></sup>:<div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>olembic</span> <span class=kn>import</span> <span class=n>op</span> <span class=c1>#They already have this</span></span>
<span class=code-line><span class=o>...</span></span>
<span class=code-line><span class=k>def</span> <span class=nf>upgrade</span><span class=p>():</span></span>
<span class=code-line>    <span class=k>with</span> <span class=n>op</span><span class=o>.</span><span class=n>batch_alter_table</span><span class=p>(</span><span class=s1>&#39;table_name&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>batch_op</span><span class=p>:</span></span>
<span class=code-line>        <span class=n>batch_op</span><span class=o>.</span><span class=n>drop_column</span><span class=p>(</span><span class=s1>&#39;the_column_to_remove&#39;</span><span class=p>)</span></span>
<span class=code-line><span class=o>...</span></span>
</pre></div><h2 id=chapter-5-user-logins><a class=toclink href=#chapter-5-user-logins>Chapter 5: User Logins</a></h2><ul><li>Password Hashing<li>Introduction to Flask-Login<li>Preparing The User Model for Flask-Login<li>User Loader Function<li>Logging Users In<li>Logging Users Out<li>Requiring Users To Login<li>Showing The Logged In User in Templates<li>User Registration</ul><p>Import:<h3 id=password-hashing><a class=toclink href=#password-hashing>Password Hashing</a></h3><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>werkzeug.security</span> <span class=kn>import</span> <span class=n>generate_password_hash</span><span class=p>,</span> <span class=n>check_password_hash</span></span>
<span class=code-line><span class=c1># generate_password_hash is a function receiving a string parameter and hashing it to an encrypted string. Different returned hash even for the same password.</span></span>
<span class=code-line><span class=c1># check_password_hash is a function receiving two parameters, first being a hash, second being a string parameter as a password to see if the original password from the hash is the same as the password.</span></span>
</pre></div><h3 id=introduction-to-flask-login><a class=toclink href=#introduction-to-flask-login>Introduction to Flask-Login</a></h3><p>New package needed: <code>flask-login</code><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>LoginManager</span></span>
<span class=code-line><span class=c1># LoginManager is a function receiving Flask app object as a parameter</span></span>
<span class=code-line><span class=c1># LoginManager(app=None, add_context_processor=True)[source]</span></span>
</pre></div><h3 id=preparing-the-user-model-for-flask-login><a class=toclink href=#preparing-the-user-model-for-flask-login>Preparing The User Model for Flask-Login</a></h3><div class=highlight><pre><span class=code-line><span></span><span class=c1># ...</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>UserMixin</span></span>
<span class=code-line><span class=c1># UserMixin provides generic implementations that are appropriate for most user model classes</span></span>
<span class=code-line><span class=k>class</span> <span class=nc>User</span><span class=p>(</span><span class=n>UserMixin</span><span class=p>,</span> <span class=n>db</span><span class=o>.</span><span class=n>Model</span><span class=p>):</span></span>
</pre></div><h3 id=user-loader-function><a class=toclink href=#user-loader-function>User Loader FUnction</a></h3><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>app</span> <span class=kn>import</span> <span class=n>login</span> <span class=c1># Here login is an object created from LoginManager function</span></span>
<span class=code-line><span class=c1># ...</span></span>
<span class=code-line></span>
<span class=code-line><span class=nd>@login.user_loader</span></span>
<span class=code-line><span class=k>def</span> <span class=nf>load_user</span><span class=p>(</span><span class=nb>id</span><span class=p>):</span></span>
<span class=code-line>    <span class=k>return</span> <span class=n>User</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=nb>id</span><span class=p>)</span></span>
</pre></div><h3 id=logging-users-in><a class=toclink href=#logging-users-in>Logging Users In</a></h3><div class=highlight><pre><span class=code-line><span></span><span class=c1># ...</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>current_user</span><span class=p>,</span> <span class=n>login_user</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>app.models</span> <span class=kn>import</span> <span class=n>User</span></span>
<span class=code-line></span>
<span class=code-line><span class=c1># ...</span></span>
<span class=code-line><span class=c1># User Class: is_authenticated, is_active, is_anonymous, get_id()</span></span>
<span class=code-line><span class=c1># login_user(user, remember=False, duration=None, force=False, fresh=True)</span></span>
<span class=code-line><span class=c1># current_user: A proxy for the current user.</span></span>
</pre></div><h3 id=logging-users-out><a class=toclink href=#logging-users-out>Logging Users Out</a></h3><div class=highlight><pre><span class=code-line><span></span><span class=c1># ...</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>logout_user</span></span>
<span class=code-line></span>
<span class=code-line><span class=c1># ...</span></span>
<span class=code-line><span class=c1># logout_user(): Log the current user out</span></span>
</pre></div><h3 id=requiring-users-to-login><a class=toclink href=#requiring-users-to-login>Requiring Users To Login</a></h3><div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask_login</span> <span class=kn>import</span> <span class=n>login_required</span></span>
<span class=code-line><span class=c1># login_required(func) does the trick</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>flask</span> <span class=kn>import</span> <span class=n>request</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>werkzeug.urls</span> <span class=kn>import</span> <span class=n>url_parse</span></span>
<span class=code-line><span class=o>...</span></span>
<span class=code-line><span class=n>next_page</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=n>args</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;next&#39;</span><span class=p>)</span> <span class=c1># This get the argument next, useful in this case</span></span>
<span class=code-line><span class=k>if</span> <span class=ow>not</span> <span class=n>next_page</span> <span class=ow>or</span> <span class=n>url_parse</span><span class=p>(</span><span class=n>next_page</span><span class=p>)</span><span class=o>.</span><span class=n>netloc</span> <span class=o>!=</span> <span class=s1>&#39;&#39;</span><span class=p>:</span></span>
<span class=code-line>    <span class=n>next_page</span> <span class=o>=</span> <span class=n>url_for</span><span class=p>(</span><span class=s1>&#39;index&#39;</span><span class=p>)</span></span>
<span class=code-line><span class=o>...</span></span>
<span class=code-line><span class=c1>#Usage above</span></span>
</pre></div><h3 id=showing-the-logged-in-user-in-templates><a class=toclink href=#showing-the-logged-in-user-in-templates>Showing The Logged In User in Templates</a></h3><p>Jinja2 things<h3 id=user-registration><a class=toclink href=#user-registration>User Registration</a></h3><p>A form similar to login form with<div class=highlight><pre><span class=code-line><span></span><span class=kn>from</span> <span class=nn>flask_wtf</span> <span class=kn>import</span> <span class=n>FlaskForm</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>wtforms</span> <span class=kn>import</span> <span class=n>StringField</span><span class=p>,</span> <span class=n>PasswordField</span><span class=p>,</span> <span class=n>BooleanField</span><span class=p>,</span> <span class=n>SubmitField</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>wtforms.validators</span> <span class=kn>import</span> <span class=n>ValidationError</span><span class=p>,</span> <span class=n>DataRequired</span><span class=p>,</span> <span class=n>Email</span><span class=p>,</span> <span class=n>EqualTo</span></span>
<span class=code-line><span class=kn>from</span> <span class=nn>app.models</span> <span class=kn>import</span> <span class=n>User</span></span>
<span class=code-line></span>
<span class=code-line><span class=c1># ...</span></span>
<span class=code-line></span>
<span class=code-line><span class=k>class</span> <span class=nc>RegistrationForm</span><span class=p>(</span><span class=n>FlaskForm</span><span class=p>):</span></span>
<span class=code-line>    <span class=n>username</span> <span class=o>=</span> <span class=n>StringField</span><span class=p>(</span><span class=s1>&#39;Username&#39;</span><span class=p>,</span> <span class=n>validators</span><span class=o>=</span><span class=p>[</span><span class=n>DataRequired</span><span class=p>()])</span></span>
<span class=code-line>    <span class=n>email</span> <span class=o>=</span> <span class=n>StringField</span><span class=p>(</span><span class=s1>&#39;Email&#39;</span><span class=p>,</span> <span class=n>validators</span><span class=o>=</span><span class=p>[</span><span class=n>DataRequired</span><span class=p>(),</span> <span class=n>Email</span><span class=p>()])</span></span>
<span class=code-line>    <span class=n>password</span> <span class=o>=</span> <span class=n>PasswordField</span><span class=p>(</span><span class=s1>&#39;Password&#39;</span><span class=p>,</span> <span class=n>validators</span><span class=o>=</span><span class=p>[</span><span class=n>DataRequired</span><span class=p>()])</span></span>
<span class=code-line>    <span class=n>password2</span> <span class=o>=</span> <span class=n>PasswordField</span><span class=p>(</span></span>
<span class=code-line>        <span class=s1>&#39;Repeat Password&#39;</span><span class=p>,</span> <span class=n>validators</span><span class=o>=</span><span class=p>[</span><span class=n>DataRequired</span><span class=p>(),</span> <span class=n>EqualTo</span><span class=p>(</span><span class=s1>&#39;password&#39;</span><span class=p>)])</span></span>
<span class=code-line>    <span class=n>submit</span> <span class=o>=</span> <span class=n>SubmitField</span><span class=p>(</span><span class=s1>&#39;Register&#39;</span><span class=p>)</span></span>
<span class=code-line></span>
<span class=code-line>    <span class=k>def</span> <span class=nf>validate_username</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>username</span><span class=p>):</span></span>
<span class=code-line>        <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>filter_by</span><span class=p>(</span><span class=n>username</span><span class=o>=</span><span class=n>username</span><span class=o>.</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span></span>
<span class=code-line>        <span class=k>if</span> <span class=n>user</span> <span class=ow>is</span> <span class=ow>not</span> <span class=bp>None</span><span class=p>:</span></span>
<span class=code-line>            <span class=k>raise</span> <span class=n>ValidationError</span><span class=p>(</span><span class=s1>&#39;Please use a different username.&#39;</span><span class=p>)</span></span>
<span class=code-line></span>
<span class=code-line>    <span class=k>def</span> <span class=nf>validate_email</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>email</span><span class=p>):</span></span>
<span class=code-line>        <span class=n>user</span> <span class=o>=</span> <span class=n>User</span><span class=o>.</span><span class=n>query</span><span class=o>.</span><span class=n>filter_by</span><span class=p>(</span><span class=n>email</span><span class=o>=</span><span class=n>email</span><span class=o>.</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>first</span><span class=p>()</span></span>
<span class=code-line>        <span class=k>if</span> <span class=n>user</span> <span class=ow>is</span> <span class=ow>not</span> <span class=bp>None</span><span class=p>:</span></span>
<span class=code-line>            <span class=k>raise</span> <span class=n>ValidationError</span><span class=p>(</span><span class=s1>&#39;Please use a different email address.&#39;</span><span class=p>)</span></span>
</pre></div><p>THen jinja2 things.<p>P.S. Hmm, to work in atom, install <code>linter-pylint</code>, <code>linter-pycodestyle</code><p>This pylintrc is helpful:<div class=highlight><pre><span class=code-line><span></span><span class=k>[MASTER]</span></span>
<span class=code-line></span>
<span class=code-line><span class=na>load-plugins</span><span class=o>=</span><span class=s>pylint_flask, pylint_sqlalchemy</span></span>
<span class=code-line><span class=na>ignored-modules</span><span class=o>=</span><span class=s>flask_sqlalchemy</span></span>
</pre></div><h2 id=chapter-6-profile-pages><a class=toclink href=#chapter-6-profile-pages>Chapter 6: Profile Pages</a></h2><ol><li>Create a route with <code>@login_required</code> function passing queried user and posts to the returned template<li>Edit the template to include the vars<li>Include <code>profile</code> link in the nav</ol><h3 id=avatars><a class=toclink href=#avatars>Avatars</a></h3><ul><li>Hash the email and use it in the url</ul><div class=highlight><pre><span class=code-line><span></span><span class=o>&gt;&gt;&gt;</span> <span class=kn>from</span> <span class=nn>hashlib</span> <span class=kn>import</span> <span class=n>md5</span></span>
<span class=code-line><span class=o>&gt;&gt;&gt;</span> <span class=s1>&#39;https://www.gravatar.com/avatar/&#39;</span> <span class=o>+</span> <span class=n>md5</span><span class=p>(</span><span class=sa>b</span><span class=s1>&#39;john@example.com&#39;</span><span class=p>)</span><span class=o>.</span><span class=n>hexdigest</span><span class=p>()</span></span>
<span class=code-line><span class=s1>&#39;https://www.gravatar.com/avatar/d4c74594d841139328695756648b6bd6&#39;</span></span>
</pre></div><p>Available argument in the url:<p><code>d</code>: default avatar, can be a url-encoded url.<br><code>s</code>: size<ul><li>Automatize the process in the module as a function to the <code>User</code> model.</ul><h3 id=using-jinja2-sub-templates><a class=toclink href=#using-jinja2-sub-templates>Using Jinja2 Sub-Templates</a></h3><ol><li>A sub-template <code>_post</code><li>reference it in the profile template</ol><h3 id=more-interesting-profiles><a class=toclink href=#more-interesting-profiles>More Interesting Profiles</a></h3><ol><li>Add two columns <code>about_me</code>, <code>last_seen</code> to the <code>User</code> model.<li>Insert them in the profile template</ol><h3 id=recording-the-last-visit-time-for-a-user><a class=toclink href=#recording-the-last-visit-time-for-a-user>Recording The Last Visit Time For a User</a></h3><p><code>@app.before_request</code> function to generate time and save it the column <code>last_seen</code> of the given user.<h3 id=profile-editor><a class=toclink href=#profile-editor>Profile Editor</a></h3><ol><li>A <code>FlaskForm</code> object<li>A template for it.<li><code>@app.route</code> with <code>methods=['GET', 'POST']</code></ol><div class=footnote><hr><ol><li id=fn:1><p><a href=https://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-i-hello-world/page/0>The Flask Mega-Tutorial Part I: Hello, World! - miguelgrinberg.com</a>&#160;<a class=footnote-backref href=#fnref:1 rev=footnote title="Jump back to footnote 1 in the text">&#8617;</a><li id=fn:2><p><a href=https://www.instructables.com/id/Setting-Up-a-Flask-Application/>Setting Up a Flask Application</a>&#160;<a class=footnote-backref href=#fnref:2 rev=footnote title="Jump back to footnote 2 in the text">&#8617;</a><li id=fn:3><p><a href=https://github.com/posativ/isso/pull/553>Mail subject customization by SnorlaxYum · Pull Request #553 · posativ/isso</a>&#160;<a class=footnote-backref href=#fnref:3 rev=footnote title="Jump back to footnote 3 in the text">&#8617;</a><li id=fn:4><p><a href="https://www.youtube.com/watch?v=CxCK1DkikgA">Dropping SQLite Columns Using Flask-Migrate - YouTube</a>&#160;<a class=footnote-backref href=#fnref:4 rev=footnote title="Jump back to footnote 4 in the text">&#8617;</a></ol></div></div><footer id=q><svg id="publish"/><b>Created:&nbsp;</b><time datetime=2019-05-31T22:08:00+02:00>May 31, 2019</time><span id=y>•</span><svg id="edit"/><b>Updated:&nbsp;</b><time datetime=2019-06-05T22:30:00+02:00>June 05, 2019</time><span id=y>•</span><svg id="session"/></svg>In a <a href=https://archives.snorl.ax/terminal/ rel="category tag"><b>Terminal</b></a> Session<span id=y>•</span><svg id="tags"/><b>Tags:&nbsp;</b><a href=https://archives.snorl.ax/tags/python/ rel=tag>python</a>,&nbsp;<a href=https://archives.snorl.ax/tags/flask/ rel=tag>flask</a>,&nbsp;<a href=https://archives.snorl.ax/tags/learning-notes/ rel=tag>learning notes</a></footer></article><article id=m><div id=n><section id=comments data-title="Running through The Flask Mega-Tutorial Again" data-isso-id=/terminal/2019/05/31/running-through-the-flask-mega-tutorial-again/></section></div></article></main></div><footer id=g><div id=l>Simputer Archives &#169; 2016 - 2019 (<a href=https://snorl.ax/>Click to view Current Version of Simputer</a>) • Licensed under <a target=_blank rel=license href=http://creativecommons.org/licenses/by/3.0/>CC BY 3.0</a><br>Made using <a href=http://getpelican.com/ target=_blank>Pelican</a> • Design from <a href=https://wordpress.org/themes/twentyfifteen/ target=_blank>TwentyFifteen</a></div></footer><script data-isso=https://isso.snorl.ax/ data-isso-gravatar=true data-isso-avatar=false data-isso-reply-notifications=true data-isso-reply-to-self=true data-isso-css=false src=https://archives.snorl.ax/theme/js/isso_embed.min.js data-isso-lang=en></script>