<!doctype html><html lang=en><title>Purchased a NAT VPS From CloudIPLC - Terminal In A Simputer Archives</title><meta charset=utf-8><link rel=canonical href=https://archives.snorl.ax/drafts/purchased-a-nat-vps-from-cloudiplc.html><link href=https://archives.snorl.ax/theme/css/all.css rel=stylesheet><link rel=dns-prefetch href=https://fonts.googleapis.com><link rel=dns-prefetch href=https://fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Luckiest+Guy|Rajdhani:600|Rajdhani:700&amp;display=swap"><link href=https://archives.snorl.ax/theme/images/icon.png rel=icon><link href=https://archives.snorl.ax/theme/images/icon-apple.png rel=apple-touch-icon-precomposed><link href=https://archives.snorl.ax/feeds/all.xml rel=alternate title="Simputer Archives RSS Feed" type=application/rss+xml><meta content=CloudIPLC name=tags><meta content=VPS name=tags><meta content=NAT name=tags><meta content=Chinese name=tags><meta content=BBR name=tags><meta content=Proxy name=tags><meta content="width=device-width" name=viewport><meta name=twitter:card content=summary><meta name=twitter:image content=https://archives.snorl.ax/theme/images/usual-twitter.png><meta name=twitter:site content=@Snorl_ax><meta name=twitter:title content="Purchased a NAT VPS From CloudIPLC"><meta name=twitter:description content="Whether living in China or not, that could be a must for me."><div id=a><header id=c><div id=d><h1 id=e><a href=https://archives.snorl.ax/>Simputer Archives</a></h1></div></header><div id=f><nav id=h><ul><li><a href=https://archives.snorl.ax/>Home</a><li><a href=https://archives.snorl.ax/browser/>Browser</a><li id=i><a href=https://archives.snorl.ax/terminal/>Terminal</a><li><a href=https://archives.snorl.ax/tags/>Tags</a></ul></nav><nav id=r><a href=https://www.youtube.com/channel/UCnqOLMtPJaqa7e_6FhZ8-rw title=Youtube><svg id="youtube"/></a><a href=https://github.com/SnorlaxYum/ title=Github><svg id="github"/></a><a href=https://twitter.com/Snorl_ax title=Twitter><svg id="twitter"/></a><a href=https://archives.snorl.ax/feeds/all.xml title=RSS><svg id="rss"/></a><a href=mailto:sim@snorl.ax title=Email><svg id="mail"/></a></nav><aside id=j><form action=https://archives.snorl.ax/search.html onsubmit="return validateForm(this.elements['q'].value);"><input placeholder=Search... name=q id=tipue_search_input></form></aside></div></div><div id=b><main id=k><article id=m><header id=o><h2 id=p>Purchased a NAT VPS From CloudIPLC</h2></header><div id=n><h2 id=toc>Table Of Contents</h2><div class=toc><ul><li><a href=#forwarding-the-traffic>Forwarding The Traffic</a><ul><li><a href=#step-1-check-if-ipv4ip_forward-is-open>Step 1: Check if ipv4.ip_forward is open</a><li><a href=#step-2-add-rules-to-iptables>Step 2: Add rules to iptables</a><li><a href=#step-3-apply-the-changes>Step 3: Apply The Changes</a></ul><li><a href=#speed-up-using-bbr>Speed Up Using BBR</a><li><a href=#create-a-chinese-proxy>Create A Chinese Proxy</a></ul></div><p>Today I purchased a NAT VPS from <a href="https://www.cloudiplc.com/aff.php?aff=371">CloudIPLC</a>. The plan was <code>CN-XZ CT-NAT Micro</code>, the price was 39.99 RMB a month. Luckily that was the last one. Though I found out that it was not faster than a websocket v2ray proxy running through a Chinese CDN.<h2 id=forwarding-the-traffic><a class=toclink href=#forwarding-the-traffic>Forwarding The Traffic</a></h2><p>Thank the tutorial for the detailed information.<sup id=fnref:1><a class=footnote-ref href=#fn:1 rel=footnote>1</a></sup><p>I reinstalled Debian Stretch so the following steps were done on it.<h3 id=step-1-check-if-ipv4ip_forward-is-open><a class=toclink href=#step-1-check-if-ipv4ip_forward-is-open>Step 1: Check if <code>ipv4.ip_forward</code> is open</a></h3><p>Firstly, ensure ip forwarding feature of ipv4 is open.<div class=highlight><pre><span class=code-line><span></span>root@server:~$ sysctl net.ipv4.ip_forward</span>
</pre></div><p>Good to go to the <code>Step 2</code> if the following output is shown:<div class=highlight><pre><span class=code-line><span></span>&gt; net.ipv4.ip_forward = 1</span>
</pre></div><p>Otherwise add the option to <code>/etc/sysctl.conf</code>:<div class=highlight><pre><span class=code-line><span></span>root@server:~$ echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf</span>
<span class=code-line>root@server:~$ sysctl -p</span>
</pre></div><h3 id=step-2-add-rules-to-iptables><a class=toclink href=#step-2-add-rules-to-iptables>Step 2: Add rules to iptables</a></h3><p><code>[the local ip of this server]</code> can be seen from the admin panel of their site.<p>Suppose I want to forward a port from the original server to a port with the same number from this server:<div class=highlight><pre><span class=code-line><span></span>root@server:~$ iptables -t nat -A PREROUTING -p tcp --dport [port] -j DNAT --to-destination [original server ip]</span>
<span class=code-line>root@server:~$ iptables -t nat -A PREROUTING -p udp --dport [port] -j DNAT --to-destination [original server ip]</span>
<span class=code-line>root@server:~$ iptables -t nat -A POSTROUTING -p tcp -d [original server ip] --dport [port] -j SNAT --to-source [the local ip of this server]</span>
<span class=code-line>root@server:~$ iptables -t nat -A POSTROUTING -p udp -d [original server ip] --dport [port] -j SNAT --to-source [the local ip of this server]</span>
</pre></div><p>Suppose I want to forward port 1111 from the original server to port 11111 from this server:<div class=highlight><pre><span class=code-line><span></span>root@server:~$ iptables -t nat -A PREROUTING -p tcp -m tcp --dport 11111 -j DNAT --to-destination [original server ip]:1111</span>
<span class=code-line>root@server:~$ iptables -t nat -A PREROUTING -p udp -m udp --dport 11111 -j DNAT --to-destination [original server ip]:1111</span>
<span class=code-line>root@server:~$ iptables -t nat -A POSTROUTING -d [original server ip] -p tcp -m tcp --dport 1111 -j SNAT --to-source [the local ip of this server]</span>
<span class=code-line>root@server:~$ iptables -t nat -A POSTROUTING -d [original server ip] -p udp -m udp --dport 1111 -j SNAT --to-source [the local ip of this server]</span>
</pre></div><h3 id=step-3-apply-the-changes><a class=toclink href=#step-3-apply-the-changes>Step 3: Apply The Changes</a></h3><div class=highlight><pre><span class=code-line><span></span>root@server:~$ iptables-save &gt; /etc/iptables.up.rules</span>
<span class=code-line>root@server:~$ iptables-restore &lt; /etc/iptables.up.rules</span>
</pre></div><h2 id=speed-up-using-bbr><a class=toclink href=#speed-up-using-bbr>Speed Up Using BBR</a></h2><p>It's a must and helpful<sup id=fnref:2><a class=footnote-ref href=#fn:2 rel=footnote>2</a></sup>.<p>Install <code>speedtest-cli</code> and test the speed:<div class=highlight><pre><span class=code-line><span></span>root@server:~$ apt install ca-certificates speedtest-cli &amp;&amp; speedtest-cli</span>
</pre></div><p>Append the needed lines to <code>/etc/sysctl.conf</code>, then reload the changes:<div class=highlight><pre><span class=code-line><span></span>root@server:~$ echo &quot;net.core.default_qdisc=fq&quot; &gt;&gt; /etc/sysctl.conf</span>
<span class=code-line>root@server:~$ echo &quot;net.ipv4.tcp_congestion_control=bbr&quot; &gt;&gt; /etc/sysctl.conf</span>
<span class=code-line>root@server:~$ sysctl --system</span>
</pre></div><p>Then test again:<div class=highlight><pre><span class=code-line><span></span>root@server:~$ speedtest-cli</span>
</pre></div><p>In my test, the download speed went up by around 1 MB/s. It's only a value. I could feel the change when I was watching Youtube and seeing the debug info.<h2 id=create-a-chinese-proxy><a class=toclink href=#create-a-chinese-proxy>Create A Chinese Proxy</a></h2><p>Since it's a VPS with a domain with constantly changed <strong>Chinese IP</strong>, it's possible to create a proxy on with with packages like V2Ray. With the Chinese IP it's possible to unblock some Chinese-restricted contents like some contents in Bilibili. I think it's the main use of it.<p>I'm gonna skip the <code>How To</code> part here. There are enough tutorials about it. Since I've created V2Ray Proxy on servers and <code>git push</code> the config files to Gitlab, I just <code>git pull</code> the files and changed the port and got them into use.<div class=footnote><hr><ol><li id=fn:1><p><a href="https://www.cloudiplc.com/knowledgebase.php?action=displayarticle&amp;id=9">通过iptables实现IP端口数据包转发服务配置</a>&#160;<a class=footnote-backref href=#fnref:1 rev=footnote title="Jump back to footnote 1 in the text">&#8617;</a><li id=fn:2><p><a href=https://www.cyberciti.biz/cloud-computing/increase-your-linux-server-internet-speed-with-tcp-bbr-congestion-control/>Increase your Linux server Internet speed with TCP BBR congestion control</a>&#160;<a class=footnote-backref href=#fnref:2 rev=footnote title="Jump back to footnote 2 in the text">&#8617;</a></ol></div></div><footer id=q><svg id="publish"/><b>Created:&nbsp;</b><time datetime=2019-06-22T17:55:00+02:00>June 22, 2019</time><span id=y>•</span><svg id="edit"/><b>Updated:&nbsp;</b><time datetime=2019-08-05T18:08:00+02:00>August 05, 2019</time><span id=y>•</span><svg id="session"/></svg>In a <a href=https://archives.snorl.ax/terminal/ rel="category tag"><b>Terminal</b></a> Session<span id=y>•</span><svg id="tags"/><b>Tags:&nbsp;</b><a href=https://archives.snorl.ax/tags/cloudiplc/ rel=tag>CloudIPLC</a>,&nbsp;<a href=https://archives.snorl.ax/tags/vps/ rel=tag>VPS</a>,&nbsp;<a href=https://archives.snorl.ax/tags/nat/ rel=tag>NAT</a>,&nbsp;<a href=https://archives.snorl.ax/tags/chinese/ rel=tag>Chinese</a>,&nbsp;<a href=https://archives.snorl.ax/tags/bbr/ rel=tag>BBR</a>,&nbsp;<a href=https://archives.snorl.ax/tags/proxy/ rel=tag>Proxy</a></footer></article><article id=m><div id=n><section id=comments data-title="Purchased a NAT VPS From CloudIPLC" data-isso-id=/drafts/purchased-a-nat-vps-from-cloudiplc.html></section></div></article></main></div><footer id=g><div id=l>Simputer Archives &#169; 2016 - 2019 (<a href=https://snorl.ax/>Click to view Current Version of Simputer</a>) • Licensed under <a target=_blank rel=license href=http://creativecommons.org/licenses/by/3.0/>CC BY 3.0</a><br>Made using <a href=http://getpelican.com/ target=_blank>Pelican</a> • Design from <a href=https://wordpress.org/themes/twentyfifteen/ target=_blank>TwentyFifteen</a></div></footer><script data-isso=https://isso.snorl.ax/ data-isso-gravatar=true data-isso-avatar=false data-isso-reply-notifications=true data-isso-reply-to-self=true data-isso-css=false src=https://archives.snorl.ax/theme/js/isso_embed.min.js data-isso-lang=en></script>